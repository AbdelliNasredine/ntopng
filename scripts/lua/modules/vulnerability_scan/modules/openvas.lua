--
-- (C) 2020-23 - ntop.org
--

local vs_module = {}

package.path = dirs.installdir .. "/scripts/lua/modules/vulnerability_scan/?.lua;" .. package.path
local vs_utils = require("vs_utils")

-- ##############################################

function vs_module:new()
   local obj = { name = "openvas" }

   setmetatable(obj, self)
   self.__index = self

   return obj
end

-- ##############################################

function vs_module:is_enabled()
   return(vs_utils.is_nmap_installed())
end

-- ##############################################

-- NOTE: ports are comma separated (e.g 80,443)

function vs_module:scan_host(host_ip, ports, use_coroutines)
   local command = "nmap -sV --script=vulscan/vulscan.nse --script-args vulscandb=openvas.csv" -- <target> -p 80,233

   -- IMPORTANT: disabling coroutines as this module hangs with them
   return(vs_utils.nmap_scan_host(command, host_ip, ports, false, self.name))
end

-- ##############################################

return vs_module

