--
-- (C) 2019-23 - ntop.org
--

--
-- This script performs the scheduled vulnerability scans
--

local dirs = ntop.getDirs()
package.path = dirs.installdir .. "/scripts/lua/modules/?.lua;" .. package.path
package.path = dirs.installdir .. "/scripts/lua/modules/vulnerability_scan/?.lua;".. package.path
local vs_utils = require "vs_utils"


local use_coroutines = true
local max_num_scans_for_loop = 64 -- avoid lasting too long (too many loops)
local num_scans = vs_utils.process_all_scheduled_scans(max_num_scans_for_loop, use_coroutines)

local is_periodic_scan_over, periodicity = vs_utils.is_periodic_scan_over()

if (is_periodic_scan_over) then
    vs_utils.notify_end_periodicity_or_all_scan(true, periodicity)
end

local is_scan_all_over = vs_utils.is_scan_all_over()

if (is_scan_all_over) then
    vs_utils.notify_end_periodicity_or_all_scan(false, nil)
end

